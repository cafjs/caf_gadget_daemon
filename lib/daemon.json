{
    "name": "top",
    "module" : "./iot_main",
    "description" : "Platform supervisor",
    "env" : {
        "myId" : "process.env.MY_ID||null",
        "tokenDir" : "process.env.TOKEN_DIR||/config",
        "tokenFile" : "process.env.TOKEN_FILE||token",
        "mailboxDir" : "process.env.MAILBOX_DIR||/control",
        "mailboxFile" : "process.env.MAILBOX_FILE||mailbox",
        "iotSession" : "process.env.IOT_SESSION||iot",
        "appProtocol" : "process.env.APP_PROTOCOL||https",
        "appPublisher" :"process.env.APP_PUBLISHER||root",
        "appLocalName" : "process.env.APP_LOCAL_NAME||gadget",
        "appSuffix" : "process.env.APP_SUFFIX||cafjs.com",
        "synchronousInit" : "process.env.SYNCHRONOUS_INIT||true",
        "maxRetries" : "process.env.MAX_RETRIES||10",
        "retryDelay" : "process.env.RETRY_DELAY||2000",
        "interval": "process.env.INTERVAL||5000",
        "longInterval": "process.env.LONG_INTERVAL||10000",
        "dieDelay": "process.env.DIE_DELAY||-1",
        "maxHangRetries":  "process.env.MAX_HANG_RETRIES||200",
        "netName" : "process.env.NET_NAME||bridge",
        "netAlreadyCreated" : "process.env.NET_ALREADY_CREATED||true",
        "trustedPubKeyFile" : "process.env.TRUSTED_PUB_KEY_FILE||rsa_pub.pem"
    },
    "components": [
        {
            "name": "log",
            "module": "caf_iot#caf_components#plug_log",
            "description": "Logger service",
            "env" : {
                "logLevel" : "DEBUG"
            }
        },
        {
            "name": "cloud",
            "module": "caf_iot#plug_iot_cloud",
            "description": "Connection to a CA.",
            "env" : {
                "maxRetries" : "$._.env.maxRetries",
                "retryDelay" : "$._.env.retryDelay",
                "appProtocol" : "$._.env.appProtocol",
                "appPublisher" : "$._.env.appPublisher",
                "appLocalName" : "$._.env.appLocalName",
                "appSuffix" : "$._.env.appSuffix",
                "session" : "$._.env.iotSession",
                "myId" : "$._.env.myId",
                "tokenDir" : "$._.env.tokenDir",
                "tokenFile" : "$._.env.tokenFile"
            },
            "components": [
            ]
        },
        {
            "name": "docker",
            "module": "./plug_docker",
            "description": "Plug to access the local Docker daemon\n Properties: \n",
            "env": {
                "dockerSocket" : "process.env.DOCKER_SOCKET||/var/run/docker.sock"
            }
        },
        {
            "name": "network",
            "module": "./plug_network",
            "description": "Plug that creates a Docker network.\n Properties: \n",
            "env": {
                "netName" : "$._.env.netName",
                "alreadyCreated" : "$._.env.netAlreadyCreated"
            }
        },
        {
            "name": "mailbox",
            "module": "./plug_mailbox",
            "description": "Plug that communicates with an app using a shared file.\n Properties: \n",
            "env": {
                "mailboxDir" : "$._.env.mailboxDir",
                "mailboxFile" : "$._.env.mailboxFile"
            }
        },
        {
            "name": "nap",
            "module": "./plug_nap",
            "description": "Plug that controls restart after a complete shutdown.\n Properties: \n",
            "env": {
                "deviceRTC" : "process.env.DEVICE_RTC||/dev/i2c-1",
                "deviceAddress" : "process.env.DEVICE_ADDRESS||0x68",
                "debugRTC" : "process.env.DEBUG_RTC||false"
            }
        },
        {
            "name": "builder",
            "module" : "./plug_builder",
            "description" : "Builds container app images.",
            "env" : {
                "buildDir" : "process.env.BUILD_DIR||/tmp/build",
                "dockerfileTemplate" : "process.env.DOCKERFILE_TEMPLATE||Dockerfile.template",
                "dockerfileDir" : "process.env.DOCKERFILE_DIR||null",
                "appProtocol" : "$._.env.appProtocol",
                "appSuffix" : "$._.env.appSuffix",
                "appFile" :"process.env.APP_FILE||iot.tgz"
            }
        },
        {
            "name": "appMgr",
            "module": "./plug_manager",
            "description": "Manages an application container.",
            "env" : {
                "__app_json__" : "app.json",
                "maxRetries" : "$._.env.maxRetries" ,
                "retryDelay" : "$._.env.retryDelay",
                "myId" : "$._.env.myId",
                "appProtocol" : "$._.env.appProtocol",
                "appSuffix" : "$._.env.appSuffix",
                "maxTokenRetries" : "process.env.MAX_TOKEN_RETRIES||30",
                "tokenDir" : "$._.env.tokenDir",
                "tokenFile" : "$._.env.tokenFile",
                "mailboxDir" : "$._.env.mailboxDir",
                "mailboxFile" : "$._.env.mailboxFile",
                "networks": ["network"],
                "trustedPubKeyFile" : "$._.env.trustedPubKeyFile"
            },
            "components" : [
            ]
        },
        {
            "name": "cronUpdates",
            "module": "./cron_updates",
            "description": "Check for app updates cron",
            "env" : {
                "interval":"$._.env.longInterval"
            }
        }
    ]
}
